<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Planes Juntos</title>
<style>
  :root{
    --bg:#0f0f12; --card:#17171b; --ink:#f3f3f4; --muted:#a9a9b3;
    --brand:#b78aff; --brand-2:#7a5cff; --ok:#37d39b; --warn:#ffb86b; --err:#ff6b6b;
    --radius:14px;
  }
  *{box-sizing:border-box;font-family:system-ui,"Segoe UI",Inter,Roboto,Ubuntu,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,#0b0b0d, #16161a);color:var(--ink);display:flex;min-height:100dvh}
  .wrap{max-width:880px;margin:auto;padding:24px; width:100%}
  .card{background:var(--card);border:1px solid #26262c;border-radius:var(--radius);padding:22px;}
  h1{margin:0 0 12px;font-weight:800;letter-spacing:.2px}
  .muted{color:var(--muted)}
  .progress{height:8px;background:#23232a;border-radius:999px;overflow:hidden;margin:10px 0 18px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:width .3s}
  .step{display:none;gap:14px}
  .step.active{display:block}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid.two{grid-template-columns:1fr 1fr} }
  label{font-weight:600}
  input[type=text], input[type=date], input[type=number], input[type=email], textarea, select{
    width:100%; padding:12px 14px; border-radius:10px; border:1px solid #2b2b33; background:#121217; color:var(--ink);
  }
  textarea{min-height:96px; resize:vertical}
  .chips{display:flex;flex-wrap:wrap; gap:8px}
  .chip input{display:none}
  .chip span{display:inline-block;border:1px solid #2b2b33;padding:10px 14px;border-radius:999px;cursor:pointer}
  .chip input:checked + span{border-color:var(--brand); box-shadow:0 0 0 2px #000 inset; background:#1e1b2b}
  .range-wrap{display:flex;align-items:center;gap:12px}
  .range-wrap output{min-width:90px;text-align:right;color:var(--muted)}
  .btns{display:flex;gap:10px;justify-content:space-between;margin-top:16px}
  button{appearance:none;border:0;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
  .primary{background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:white}
  .ghost{background:#22222a; color:var(--ink)}
  .ok{color:#0c2; font-weight:700}
  .err{color:#ff6b6b; font-weight:700}
  .small{font-size:.92rem}
  .footer{margin-top:12px;color:var(--muted);font-size:.9rem}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Formulario de viaje ‚úàÔ∏è</h1>
      <p class="muted">Ay√∫dame a prepararte un viaje perfecto. Solo tardas 2‚Äì3 min.</p>

      <div class="progress"><div class="bar" id="bar"></div></div>

      <form id="tripForm" class="grid" autocomplete="on" novalidate>
        <!-- STEP 1 -->
        <div class="step active" data-step="1">
          <div class="grid two">
            <div>
              <label for="nombre">Tu nombre</label>
              <input id="nombre" name="nombre" type="text" placeholder="Nombre" required />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" placeholder="ejemplo@ejemplo.com" />
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="desde">Fechas (desde)</label>
              <input id="desde" name="desde" type="date" />
            </div>
            <div>
              <label for="hasta">Fechas (hasta)</label>
              <input id="hasta" name="hasta" type="date" />
            </div>
          </div>

          <div>
            <label>Tipo de destinos que te apetecen</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Playa"><span>Playa</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Ciudad"><span>Ciudad</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Naturaleza"><span>Naturaleza</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Cultura/Historia"><span>Cultura/Historia</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Gastronom√≠a"><span>Gastronom√≠a</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Fiesta/Noche"><span>Fiesta/Noche</span></label>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div class="step" data-step="2">
          <div>
            <label>Estilo de viaje</label>
            <div class="chips">
              <label class="chip"><input type="radio" name="estilo" value="Relax"><span>Relax</span></label>
              <label class="chip"><input type="radio" name="estilo" value="Equilibrado"><span>Equilibrado</span></label>
              <label class="chip"><input type="radio" name="estilo" value="Intenso"><span>Intenso</span></label>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="alojamiento">Alojamiento preferido</label>
              <select id="alojamiento" name="alojamiento">
                <option value="">Me vale cualquiera</option>
                <option>Hotel</option>
                <option>Apartamento/Airbnb</option>
                <option>Casa rural</option>
                <option>Hostel</option>
              </select>
            </div>
            <div>
              <label for="transporte">Transporte preferido</label>
              <select id="transporte" name="transporte">
                <option value="">Lo que salga mejor</option>
                <option>Avi√≥n</option>
                <option>Tren</option>
                <option>Bus</option>
                <option>Coche</option>
              </select>
            </div>
          </div>

          <div>
            <label>Actividades que te encanten</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="actividades" value="Museos"><span>Museos</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Senderismo"><span>Senderismo</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Playas/Calas"><span>Playas/Calas</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Gastronom√≠a local"><span>Gastronom√≠a local</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Vida nocturna"><span>Vida nocturna</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Compras"><span>Compras</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Termas/Spa"><span>Termas/Spa</span></label>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="restricciones">Alimentaci√≥n / alergias</label>
              <input id="restricciones" name="restricciones" type="text" placeholder="Sin picante, sin marisco, etc." />
            </div>
            <div>
              <label for="ritmo">Ritmo diario ideal</label>
              <select id="ritmo" name="ritmo">
                <option>Ma√±anas fuertes + tarde chill</option>
                <option>Tardes fuertes + ma√±ana chill</option>
                <option>Non-stop</option>
              </select>
            </div>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="step" data-step="3">
          <div>
            <label for="presupuesto">Presupuesto total aprox. (‚Ç¨)</label>
            <div class="range-wrap">
              <input id="presupuesto" name="presupuesto" type="range" min="100" max="3000" step="50" value="600" />
              <output id="presOut">600 ‚Ç¨</output>
            </div>
            <small class="muted small">Incluye transporte + alojamiento + actividades.</small>
          </div>

          <div class="grid two">
            <div>
              <label for="destinos">Top destinos (m√°x. 3)</label>
              <input id="destinos" name="destinos" type="text" placeholder="Ej: Lisboa, Oporto, Menorca" />
            </div>
            <div>
              <label for="evitar">L√≠mites / cosas a evitar</label>
              <input id="evitar" name="evitar" type="text" placeholder="Mucho calor, ferris, etc." />
            </div>
          </div>

          <div>
            <label for="notas">Notas extra</label>
            <textarea id="notas" name="notas" placeholder="A√±ade cualquier detalle importante"></textarea>
          </div>
        </div>

        <!-- STEP 4 -->
        <div class="step" data-step="4">
          <p>Revisa y env√≠a. Tardar√© nada en proponerte un planning ‚ú®</p>
          <ul class="muted small" id="review"></ul>
          <p class="small muted">Tus respuestas se guardan autom√°ticamente en este dispositivo hasta que env√≠es.</p>
        </div>

        <div class="btns">
          <button type="button" class="ghost" id="prev">‚Üê Atr√°s</button>
          <div style="display:flex;gap:8px">
            <button type="button" class="ghost" id="save">Guardar</button>
            <button type="button" class="primary" id="next">Siguiente ‚Üí</button>
            <button type="submit" class="primary" id="submitBtn" style="display:none">Enviar ‚úÖ</button>
          </div>
        </div>

        <p id="status" class="footer"></p>
      </form>
    </div>
  </div>

<script>
(() => {
  const form = document.getElementById('tripForm');
  const steps = [...document.querySelectorAll('.step')];
  const bar = document.getElementById('bar');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const save = document.getElementById('save');
  const submitBtn = document.getElementById('submitBtn');
  const statusEl = document.getElementById('status');
  const reviewEl = document.getElementById('review');
  const range = document.getElementById('presupuesto');
  const out = document.getElementById('presOut');
  const STORAGE_KEY = 'form_denis_viaje_v1';

  // Email endpoint (FormSubmit)
  const EMAIL_ENDPOINT = 'https://formsubmit.co/ajax/rociovelascoig@gmail.com';

  let step = 1;

  const showStep = n => {
    step = Math.max(1, Math.min(steps.length, n));
    steps.forEach(s => s.classList.remove('active'));
    steps[step-1].classList.add('active');
    bar.style.width = ((step-1)/(steps.length-1))*100 + '%';
    prev.style.visibility = step === 1 ? 'hidden' : 'visible';
    next.style.display = step < steps.length ? '' : 'none';
    submitBtn.style.display = step === steps.length ? '' : 'none';
    status('');
    if(step===steps.length) buildReview();
  };

  const status = (msg, type='') => {
    statusEl.textContent = msg;
    statusEl.className = 'footer ' + (type || '');
  };

  const serialize = () => {
    const fd = new FormData(form);
    const data = {};
    for (const [k,v] of fd.entries()){
      if (data[k]) {
        if (Array.isArray(data[k])) data[k].push(v); else data[k] = [data[k], v];
      } else data[k] = v;
    }
    data._submitted_at = new Date().toISOString();
    return data;
  };

  const autosave = () => {
    const data = serialize();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    status('Borrador guardado localmente.', 'small');
  };

  const load = () => {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      for (const [k,v] of Object.entries(data)){
        const el = form.elements[k];
        if(!el) continue;
        if (el instanceof RadioNodeList){
          [...form.querySelectorAll(`[name="${k}"]`)].forEach(inp=>{
            if (Array.isArray(v)) inp.checked = v.includes(inp.value);
            else inp.checked = inp.value === v;
          });
        } else if (el.type === 'checkbox'){
          el.checked = !!v;
        } else if (!Array.isArray(v)){
          el.value = v;
        }
      }
      if (data.presupuesto) { range.value = data.presupuesto; out.textContent = `${data.presupuesto} ‚Ç¨`; }
      status('Borrador cargado.', 'small');
    }catch(e){}
  };

  const validateStep = () => {
    if (step===1 && !form.nombre.value.trim()){ status('Pon tu nombre, porfa.', 'err'); return false; }
    if (step===3 && range.value < 100){ status('Presupuesto m√≠nimo 100 ‚Ç¨.', 'err'); return false; }
    status(''); return true;
  };

  const buildReview = () => {
    const data = serialize();
    const entries = [
      ['Nombre', data.nombre || '‚Äî'],
      ['Email', data.email || '‚Äî'],
      ['Fechas', `${data.desde||'‚Äî'} ‚Üí ${data.hasta||'‚Äî'}`],
      ['Tipos de destino', (data.destinos_tipo? [].concat(data.destinos_tipo).join(', ') : '‚Äî')],
      ['Estilo', data.estilo || '‚Äî'],
      ['Alojamiento', data.alojamiento || '‚Äî'],
      ['Transporte', data.transporte || '‚Äî'],
      ['Actividades', (data.actividades? [].concat(data.actividades).join(', ') : '‚Äî')],
      ['Alimentaci√≥n/alergias', data.restricciones || '‚Äî'],
      ['Ritmo', data.ritmo || '‚Äî'],
      ['Presupuesto', (data.presupuesto? data.presupuesto + ' ‚Ç¨' : '‚Äî')],
      ['Top destinos', data.destinos || '‚Äî'],
      ['Evitar', data.evitar || '‚Äî'],
      ['Notas', data.notas || '‚Äî'],
    ];
    reviewEl.innerHTML = entries.map(([k,v]) => `<li><strong>${k}:</strong> <span class="muted">${v}</span></li>`).join('');
  };

  // Navegaci√≥n
  next.addEventListener('click', () => { if (!validateStep()) return; showStep(step+1); });
  prev.addEventListener('click', () => showStep(step-1));
  save.addEventListener('click', autosave);
  form.addEventListener('input', e => { if(e.target===range) out.textContent = `${range.value} ‚Ç¨`; });
  form.addEventListener('change', e => { if(e.target===range) out.textContent = `${range.value} ‚Ç¨`; autosave(); });

  // Env√≠o a tu email con FormSubmit
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = serialize();
    status('Enviando‚Ä¶');

    // Personalizamos asunto y dejamos que FormSubmit genere tabla
    const payload = {
      _subject: `Nueva respuesta: ${data.nombre || 'Sin nombre'} ‚Äî Viaje Denis`,
      _template: "table",
      _replyto: data.email || "",
      ...data
    };

    try{
      const res = await fetch(EMAIL_ENDPOINT, {
        method:'POST',
        headers: {
          'Content-Type':'application/json',
          'Accept':'application/json'
        },
        body: JSON.stringify(payload)
      });
      const resp = await res.json().catch(()=> ({}));
      if (!res.ok) throw new Error(resp?.message || `HTTP ${res.status}`);

      localStorage.removeItem(STORAGE_KEY);
      status('¬°Enviado! Revisa tu correo üì¨', 'ok');
      form.reset(); showStep(1); window.scrollTo({top:0, behavior:'smooth'});
    }catch(err){
      console.error(err);
      status('No se pudo enviar. Intenta de nuevo m√°s tarde.', 'err');
    }
  });

  // init
  load();
  showStep(1);
  out.textContent = `${range.value} ‚Ç¨`;
})();
</script>
</body>
</html>

