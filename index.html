<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Planes Juntos</title>

<!-- ADDED: manifest para PWA -->
<link rel="manifest" href="manifest.webmanifest" />
<meta name="theme-color" content="#1e3a8a" />

<style>
  :root{
    --bg:#0f0f12; --card:#17171b; --ink:#f3f3f4; --muted:#a9a9b3;
    --brand:#b78aff; --brand-2:#7a5cff; --ok:#37d39b; --warn:#ffb86b; --err:#ff6b6b;
    --radius:14px;
  }
  *{box-sizing:border-box;font-family:system-ui,"Segoe UI",Inter,Roboto,Ubuntu,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,#0b0b0d, #16161a);color:var(--ink);display:flex;min-height:100dvh}
  .wrap{max-width:880px;margin:auto;padding:24px; width:100%}
  .card{background:var(--card);border:1px solid #26262c;border-radius:var(--radius);padding:22px;}
  h1{margin:0 0 12px;font-weight:800;letter-spacing:.2px}
  .muted{color:var(--muted)}
  .progress{height:8px;background:#23232a;border-radius:999px;overflow:hidden;margin:10px 0 18px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:width .3s}
  .step{display:none;gap:14px}
  .step.active{display:block}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid.two{grid-template-columns:1fr 1fr} }
  label{font-weight:600}
  input[type=text], input[type=date], input[type=number], input[type=email], textarea, select{
    width:100%; padding:12px 14px; border-radius:10px; border:1px solid #2b2b33; background:#121217; color:var(--ink);
  }
  textarea{min-height:96px; resize:vertical}
  .chips{display:flex;flex-wrap:wrap; gap:8px}
  .chip input{display:none}
  .chip span{display:inline-block;border:1px solid #2b2b33;padding:10px 14px;border-radius:999px;cursor:pointer}
  .chip input:checked + span{border-color:var(--brand); box-shadow:0 0 0 2px #000 inset; background:#1e1b2b}
  .range-wrap{display:flex;align-items:center;gap:12px}
  .range-wrap output{min-width:90px;text-align:right;color:var(--muted)}
  .btns{display:flex;gap:10px;justify-content:space-between;margin-top:16px}
  button{appearance:none;border:0;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
  .primary{background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:white}
  .ghost{background:#22222a; color:var(--ink)}
  .ok{color:#0c2; font-weight:700}
  .err{color:#ff6b6b; font-weight:700}
  .small{font-size:.92rem}
  .footer{margin-top:12px;color:var(--muted);font-size:.9rem}
  .countdowns{
  display:flex; gap:10px; flex-wrap:wrap; margin:6px 0 12px
}
.cd-pill{
  display:flex; align-items:center; gap:8px;
  background:#121217; border:1px solid #2b2b33; color:var(--ink);
  padding:8px 12px; border-radius:999px; font-size:.95rem
}
.cd-pill strong{ font-weight:800 }
.cd-soon { border-color: var(--warn) }
.cd-today { border-color: var(--ok) }
.cd-past { opacity:.85; color:var(--muted) }

</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Formulario de viaje ✈️</h1>
      <div id="countdowns" class="countdowns">
  <div class="cd-pill">
    <strong>Próximo encuentro</strong>
    <span id="cd-proxima"></span>
  </div>
  <div class="cd-pill">
    <strong>Aniversario</strong>
    <span id="cd-aniversario"></span>
  </div>
</div>
      <p class="muted">Ayúdame a prepararte un viaje perfecto. Solo tardas 2–3 min.</p>

      <div class="progress"><div class="bar" id="bar"></div></div>

      <form id="tripForm" class="grid" autocomplete="on" novalidate>
        <!-- STEP 1 -->
        <div class="step active" data-step="1">
          <div class="grid two">
            <div>
              <label for="nombre">Tu nombre</label>
              <input id="nombre" name="nombre" type="text" placeholder="Nombre" required />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" placeholder="ejemplo@ejemplo.com" />
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="desde">Fechas (desde)</label>
              <input id="desde" name="desde" type="date" />
            </div>
            <div>
              <label for="hasta">Fechas (hasta)</label>
              <input id="hasta" name="hasta" type="date" />
            </div>
          </div>

          <div>
            <label>Tipo de destinos que te apetecen</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Playa"><span>Playa</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Ciudad"><span>Ciudad</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Naturaleza"><span>Naturaleza</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Cultura/Historia"><span>Cultura/Historia</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Gastronomía"><span>Gastronomía</span></label>
              <label class="chip"><input type="checkbox" name="destinos_tipo" value="Fiesta/Noche"><span>Fiesta/Noche</span></label>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div class="step" data-step="2">
          <div>
            <label>Estilo de viaje</label>
            <div class="chips">
              <label class="chip"><input type="radio" name="estilo" value="Relax"><span>Relax</span></label>
              <label class="chip"><input type="radio" name="estilo" value="Equilibrado"><span>Equilibrado</span></label>
              <label class="chip"><input type="radio" name="estilo" value="Intenso"><span>Intenso</span></label>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="alojamiento">Alojamiento preferido</label>
              <select id="alojamiento" name="alojamiento">
                <option value="">Me vale cualquiera</option>
                <option>Hotel</option>
                <option>Apartamento/Airbnb</option>
                <option>Casa rural</option>
                <option>Hostel</option>
              </select>
            </div>
            <div>
              <label for="transporte">Transporte preferido</label>
              <select id="transporte" name="transporte">
                <option value="">Lo que salga mejor</option>
                <option>Avión</option>
                <option>Tren</option>
                <option>Bus</option>
                <option>Coche</option>
              </select>
            </div>
          </div>

          <div>
            <label>Actividades que te encanten</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="actividades" value="Museos"><span>Museos</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Senderismo"><span>Senderismo</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Playas/Calas"><span>Playas/Calas</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Gastronomía local"><span>Gastronomía local</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Vida nocturna"><span>Vida nocturna</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Compras"><span>Compras</span></label>
              <label class="chip"><input type="checkbox" name="actividades" value="Termas/Spa"><span>Termas/Spa</span></label>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="restricciones">Alimentación / alergias</label>
              <input id="restricciones" name="restricciones" type="text" placeholder="Sin picante, sin marisco, etc." />
            </div>
            <div>
              <label for="ritmo">Ritmo diario ideal</label>
              <select id="ritmo" name="ritmo">
                <option>Mañanas fuertes + tarde chill</option>
                <option>Tardes fuertes + mañana chill</option>
                <option>Non-stop</option>
              </select>
            </div>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="step" data-step="3">
          <div>
            <label for="presupuesto">Presupuesto total aprox. (€)</label>
            <div class="range-wrap">
              <input id="presupuesto" name="presupuesto" type="range" min="100" max="3000" step="50" value="600" />
              <output id="presOut">600 €</output>
            </div>
            <small class="muted small">Incluye transporte + alojamiento + actividades.</small>
          </div>

          <div class="grid two">
            <div>
              <label for="destinos">Top destinos (máx. 3)</label>
              <input id="destinos" name="destinos" type="text" placeholder="Ej: Lisboa, Oporto, Menorca" />
            </div>
            <div>
              <label for="evitar">Límites / cosas a evitar</label>
              <input id="evitar" name="evitar" type="text" placeholder="Mucho calor, ferris, etc." />
            </div>
          </div>

          <div>
            <label for="notas">Notas extra</label>
            <textarea id="notas" name="notas" placeholder="Añade cualquier detalle importante"></textarea>
          </div>
        </div>

        <!-- STEP 4 -->
        <div class="step" data-step="4">
          <p>Revisa y envía. Tardaré nada en proponerte un planning ✨</p>
          <ul class="muted small" id="review"></ul>
          <p class="small muted">Tus respuestas se guardan automáticamente en este dispositivo hasta que envíes.</p>
        </div>

        <div class="btns">
          <button type="button" class="ghost" id="prev">← Atrás</button>
          <div style="display:flex;gap:8px">
            <button type="button" class="ghost" id="save">Guardar</button>
            <button type="button" class="primary" id="next">Siguiente →</button>
            <button type="submit" class="primary" id="submitBtn" style="display:none">Enviar ✅</button>
          </div>
        </div>

        <p id="status" class="footer"></p>
      </form>
    </div>
  </div>

<script>
(() => {
  const form = document.getElementById('tripForm');
  const steps = [...document.querySelectorAll('.step')];
  const bar = document.getElementById('bar');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const save = document.getElementById('save');
  const submitBtn = document.getElementById('submitBtn');
  const statusEl = document.getElementById('status');
  const reviewEl = document.getElementById('review');
  const range = document.getElementById('presupuesto');
  const out = document.getElementById('presOut');
  const STORAGE_KEY = 'form_denis_viaje_v1';

  // Email endpoint (FormSubmit)
  const EMAIL_ENDPOINT = 'https://formsubmit.co/ajax/rociovelascoig@gmail.com';

  let step = 1;

  const showStep = n => {
    step = Math.max(1, Math.min(steps.length, n));
    steps.forEach(s => s.classList.remove('active'));
    steps[step-1].classList.add('active');
    bar.style.width = ((step-1)/(steps.length-1))*100 + '%';
    prev.style.visibility = step === 1 ? 'hidden' : 'visible';
    next.style.display = step < steps.length ? '' : 'none';
    submitBtn.style.display = step === steps.length ? '' : 'none';
    status('');
    if(step===steps.length) buildReview();
  };

  const status = (msg, type='') => {
    statusEl.textContent = msg;
    statusEl.className = 'footer ' + (type || '');
  };

  const serialize = () => {
    const fd = new FormData(form);
    const data = {};
    for (const [k,v] of fd.entries()){
      if (data[k]) {
        if (Array.isArray(data[k])) data[k].push(v); else data[k] = [data[k], v];
      } else data[k] = v;
    }
    data._submitted_at = new Date().toISOString();
    return data;
  };

  const autosave = () => {
    const data = serialize();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    status('Borrador guardado localmente.', 'small');
  };

  const load = () => {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      for (const [k,v] of Object.entries(data)){
        const el = form.elements[k];
        if(!el) continue;
        if (el instanceof RadioNodeList){
          [...form.querySelectorAll(`[name="${k}"]`)].forEach(inp=>{
            if (Array.isArray(v)) inp.checked = v.includes(inp.value);
            else inp.checked = inp.value === v;
          });
        } else if (el.type === 'checkbox'){
          el.checked = !!v;
        } else if (!Array.isArray(v)){
          el.value = v;
        }
      }
      if (data.presupuesto) { range.value = data.presupuesto; out.textContent = `${data.presupuesto} €`; }
      status('Borrador cargado.', 'small');
    }catch(e){}
  };

  const validateStep = () => {
    if (step===1 && !form.nombre.value.trim()){ status('Pon tu nombre, porfa.', 'err'); return false; }
    if (step===3 && range.value < 100){ status('Presupuesto mínimo 100 €.', 'err'); return false; }
    status(''); return true;
  };

  const buildReview = () => {
    const data = serialize();
    const entries = [
      ['Nombre', data.nombre || '—'],
      ['Email', data.email || '—'],
      ['Fechas', `${data.desde||'—'} → ${data.hasta||'—'}`],
      ['Tipos de destino', (data.destinos_tipo? [].concat(data.destinos_tipo).join(', ') : '—')],
      ['Estilo', data.estilo || '—'],
      ['Alojamiento', data.alojamiento || '—'],
      ['Transporte', data.transporte || '—'],
      ['Actividades', (data.actividades? [].concat(data.actividades).join(', ') : '—')],
      ['Alimentación/alergias', data.restricciones || '—'],
      ['Ritmo', data.ritmo || '—'],
      ['Presupuesto', (data.presupuesto? data.presupuesto + ' €' : '—')],
      ['Top destinos', data.destinos || '—'],
      ['Evitar', data.evitar || '—'],
      ['Notas', data.notas || '—'],
    ];
    reviewEl.innerHTML = entries.map(([k,v]) => `<li><strong>${k}:</strong> <span class="muted">${v}</span></li>`).join('');
  };

  // Navegación
  next.addEventListener('click', () => { if (!validateStep()) return; showStep(step+1); });
  prev.addEventListener('click', () => showStep(step-1));
  save.addEventListener('click', autosave);
  form.addEventListener('input', e => { if(e.target===range) out.textContent = `${range.value} €`; });
  form.addEventListener('change', e => { if(e.target===range) out.textContent = `${range.value} €`; autosave(); });

  // Envío a tu email con FormSubmit
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = serialize();
    status('Enviando…');

    // Personalizamos asunto y dejamos que FormSubmit genere tabla
    const payload = {
      _subject: `Nueva respuesta: ${data.nombre || 'Sin nombre'} — Viaje Denis`,
      _template: "table",
      _replyto: data.email || "",
      ...data
    };

    try{
      const res = await fetch(EMAIL_ENDPOINT, {
        method:'POST',
        headers: {
          'Content-Type':'application/json',
          'Accept':'application/json'
        },
        body: JSON.stringify(payload)
      });
      const resp = await res.json().catch(()=> ({}));
      if (!res.ok) throw new Error(resp?.message || `HTTP ${res.status}`);

      localStorage.removeItem(STORAGE_KEY);
      status('¡Enviado! Revisa tu correo 📬', 'ok');
      form.reset(); showStep(1); window.scrollTo({top:0, behavior:'smooth'});
    }catch(err){
      console.error(err);
      status('No se pudo enviar. Intenta de nuevo más tarde.', 'err');
    }
  });

  // init
  load();
  showStep(1);
  out.textContent = `${range.value} €`;
})();
</script>

<!-- ADDED: registro del Service Worker (no interfiere con tu lógica) -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js').catch(() => {});
      // Si tu SW se llama distinto, ajusta la ruta arriba (p.ej. './service-worker.js')
    });
  }
</script>

<!-- ADDED: botón + lógica de instalación PWA -->
<button id="installPWA"
  hidden
  style="
    position: fixed; right: 16px; bottom: 16px; z-index: 9999;
    padding: 12px 16px; border: 0; border-radius: 999px;
    background:#1e3a8a; color:#fff; font-weight:600; box-shadow:0 6px 18px rgba(0,0,0,.25);
    cursor: pointer;
  ">
  Instalar app
</button>
<script>
  (function () {
    const btn = document.getElementById('installPWA');
    let deferredPrompt = null;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      btn.hidden = false;
    });

    btn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      btn.disabled = true;
      try {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
      } finally {
        deferredPrompt = null;
        btn.hidden = true;
        btn.disabled = false;
      }
    });

    window.addEventListener('appinstalled', () => {
      deferredPrompt = null;
      btn.hidden = true;
    });
  })();
</script>
<script>
/**
 * Cuenta atrás doble: “Próximo encuentro” y “Aniversario”.
 * - Formato fechas: 'YYYY-MM-DD' o 'DD/MM/YYYY' (se detecta).
 * - Actualiza cada segundo.
 * - Muestra días + hh:mm:ss; cuando llega el día: “¡Hoy!”.
 * - Si pasó: “Hace X días” y estilo atenuado.
 */
(function(){
  // ⚙️ Configura aquí tus fechas
  const FECHAS = {
    proxima: '20/09/2025',
    aniversario: '27/08/2026'
  };

  // Helpers
  const $ = s => document.querySelector(s);
  const parseDate = (str) => {
    // Admite 'DD/MM/YYYY' o 'YYYY-MM-DD'
    if (/^\d{2}\/\d{2}\/\d{4}$/.test(str)){
      const [d,m,y] = str.split('/').map(Number);
      return new Date(y, m-1, d, 0, 0, 0);
    }
    return new Date(str);
  };
  const pad = n => String(n).padStart(2,'0');

  const fmt = (ms) => {
    const total = Math.floor(ms/1000);
    const d = Math.floor(total/86400);
    const h = Math.floor((total%86400)/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    // “1 día” vs “2 días”
    const dLabel = d === 1 ? 'día' : 'días';
    return d > 0
      ? `${d} ${dLabel} ${pad(h)}:${pad(m)}:${pad(s)}`
      : `${pad(h)}:${pad(m)}:${pad(s)}`;
  };

  const proximaEl = $('#cd-proxima');
  const anivEl = $('#cd-aniversario');
  const proximaPill = proximaEl?.closest('.cd-pill');
  const anivPill = anivEl?.closest('.cd-pill');

  const dProx = parseDate(FECHAS.proxima);
  const dAniv = parseDate(FECHAS.aniversario);

  function tick(){
    const now = new Date();

    // Próximo encuentro
    if (proximaEl){
      const diff = dProx - now;
      proximaPill.classList.remove('cd-soon','cd-today','cd-past');
      if (diff > 0){
        proximaEl.textContent = 'Faltan ' + fmt(diff);
        // Marca visual si quedan < 5 días
        if (diff < 5*24*3600*1000) proximaPill.classList.add('cd-soon');
      } else {
        // mismo día?
        const sameDay = now.toDateString() === dProx.toDateString();
        if (sameDay){
          proximaEl.textContent = '¡Hoy!';
          proximaPill.classList.add('cd-today');
        } else {
          const daysAgo = Math.ceil((now - dProx)/86400000);
          proximaEl.textContent = `Hace ${daysAgo} ${daysAgo===1?'día':'días'}`;
          proximaPill.classList.add('cd-past');
        }
      }
    }

    // Aniversario
    if (anivEl){
      const diffA = dAniv - now;
      anivPill.classList.remove('cd-soon','cd-today','cd-past');
      if (diffA > 0){
        anivEl.textContent = 'Faltan ' + fmt(diffA);
        if (diffA < 5*24*3600*1000) anivPill.classList.add('cd-soon');
      } else {
        const sameDayA = now.toDateString() === dAniv.toDateString();
        if (sameDayA){
          anivEl.textContent = '¡Hoy!';
          anivPill.classList.add('cd-today');
        } else {
          const daysAgoA = Math.ceil((now - dAniv)/86400000);
          anivEl.textContent = `Hace ${daysAgoA} ${daysAgoA===1?'día':'días'}`;
          anivPill.classList.add('cd-past');
        }
      }
    }
  }

  tick();
  setInterval(tick, 1000);
})();
</script>
<script>
(function(){
  const f = document.getElementById('tripForm');
  const err = (el,msg)=>{ el.setCustomValidity(msg); el.reportValidity(); };
  const ok  = (el)=> el.setCustomValidity('');

  f.desde.addEventListener('change', ()=> ok(f.hasta));
  f.hasta.addEventListener('change', ()=>{
    const d1 = f.desde.value && new Date(f.desde.value);
    const d2 = f.hasta.value && new Date(f.hasta.value);
    if (d1 && d2 && d2 < d1) err(f.hasta,'La fecha “hasta” no puede ser anterior a “desde”.');
    else ok(f.hasta);
  });

  f.nombre.addEventListener('input', ()=>{
    if (f.nombre.value.trim().length < 2) err(f.nombre,'Pon al menos 2 letras, porfa.');
    else ok(f.nombre);
  });
})();
</script>
<script>
(function(){
  const form = document.getElementById('tripForm');
  const steps = [...document.querySelectorAll('.step')];
  const next  = document.getElementById('next');
  form.addEventListener('keydown', e=>{
    if (e.key === 'Enter' && !e.target.matches('textarea, [type=submit]')) {
      e.preventDefault(); next.click();
    }
  });
  // En cada paso, coloca foco en el primer input visible
  const showFocus = () => {
    const active = document.querySelector('.step.active');
    const first = active?.querySelector('input,select,textarea,button');
    first?.focus();
  };
  new MutationObserver(showFocus).observe(document.querySelector('.card'), {subtree:true, attributes:true, attributeFilter:['class']});
})();
</script>

  
</body>
</html>


