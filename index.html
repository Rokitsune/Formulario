<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Viaje juntitos ‚Äî by Ro</title>

<!-- PWA meta -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#1e3a8a">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Fuente -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#050507; --bg2:#0f172a;
    --card:rgba(15,23,42,.72); --card-border:rgba(255,255,255,.06);
    --ink:#f3f6fb; --muted:#94a3b8;
    --brand1:#2563eb; --brand2:#1d4ed8; --brand3:#0ea5e9;
    --ok:#22c55e; --warn:#facc15; --err:#ef4444;
    --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box;font-family:Poppins,system-ui,"Segoe UI",Inter,Roboto,Ubuntu,Arial,sans-serif}
  html,body{height:100%}
  body{
    margin:0;color:var(--ink);
    background: radial-gradient(1000px 700px at 80% -10%, #1e3a8a 0%, transparent 55%),
                radial-gradient(800px 600px at -10% 110%, #1e293b 0%, transparent 60%),
                linear-gradient(180deg,var(--bg1),var(--bg2));
  }
  .wrap{max-width:880px;margin:auto;padding:24px; width:100%}
  .card{
    background:var(--card); backdrop-filter: blur(10px);
    border:1px solid var(--card-border); border-radius:var(--radius);
    padding:22px; box-shadow:var(--shadow);
  }
  h1{margin:0 0 6px;font-weight:800;letter-spacing:.2px}
  .subtitle{margin:0 0 16px;color:var(--muted)}
  .muted{color:var(--muted)}
  .progress{height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;margin:10px 0 18px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3));transition:width .35s}
  .step{display:none;gap:14px}
  .step.active{display:block}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid.two{grid-template-columns:1fr 1fr} }
  label{font-weight:600}
  input[type=text], input[type=date], input[type=number], input[type=email], textarea, select{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
    background:rgba(5,8,15,.75); color:var(--ink); outline: none;
    transition: border-color .2s, box-shadow .2s, background .2s;
  }
  input:focus, textarea:focus, select:focus{
    border-color:var(--brand1); box-shadow:0 0 0 3px rgba(37,99,235,.25);
    background:rgba(10,15,25,.9);
  }
  textarea{min-height:96px; resize:vertical}
  .chips{display:flex;flex-wrap:wrap; gap:8px}
  .chip input{display:none}
  .chip span{
    display:inline-block;border:1px solid rgba(255,255,255,.08);
    padding:10px 14px;border-radius:999px;cursor:pointer;
    background:rgba(5,8,15,.65);
    transition: all .2s;
  }
  .chip span:hover{transform: translateY(-1px)}
  .chip input:checked + span{
    border-color: var(--brand1);
    background:rgba(37,99,235,.14);
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.5);
  }
  .range-wrap{display:flex;align-items:center;gap:12px}
  .range-wrap output{min-width:90px;text-align:right;color:var(--muted)}
  .btns{display:flex;gap:10px;justify-content:space-between;margin-top:16px;flex-wrap:wrap}
  button{
    appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;
    transition: transform .06s ease, box-shadow .2s ease, opacity .2s ease;
  }
  button:active{transform: translateY(1px)}
  .primary{
    color:white;
    background:linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3));
    background-size:200% 100%; animation: grad 8s ease infinite;
    box-shadow: 0 6px 20px rgba(37,99,235,.35);
  }
  @keyframes grad { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
  .ghost{background:rgba(255,255,255,.06); color:var(--ink)}
  .ok{color:#0c2; font-weight:700}
  .err{color:var(--err); font-weight:700}
  .small{font-size:.92rem}
  .footer{margin-top:12px;color:var(--muted);font-size:.9rem}
  .install-banner{display:none;margin:10px 0 0;align-items:center;gap:10px}

  /* Splash screen */
  .splash{
    position:fixed; inset:0; z-index:9999;
    background:linear-gradient(180deg,#000,#0f172a);
    display:flex; align-items:center; justify-content:center; flex-direction:column;
    color:white; font-size:1.4rem; font-weight:600;
  }
  .splash.fade-out{opacity:0;transition:opacity .6s ease;pointer-events:none}
</style>
</head>
<body>
<div class="splash" id="splash">
  <div style="font-size:2.4rem;margin-bottom:10px;">üåå</div>
  Cargando planes...
</div>

<div class="wrap">
  <div class="card">
    <h1>Formulario de viaje ‚úàÔ∏è</h1>
    <p class="subtitle">Ay√∫dame a crear nuestro viaje perfecto üíô‚ö´</p>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <form id="tripForm" class="grid" autocomplete="on" novalidate>
      <!-- Paso 1 -->
      <div class="step active" data-step="1">
        <div class="grid two">
          <div>
            <label for="nombre">Tu nombre</label>
            <input id="nombre" name="nombre" type="text" placeholder="nombre" required />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="email@ejemplo.com" />
          </div>
        </div>
      </div>

      <!-- ... Resto de pasos igual que antes ... -->

      <!-- Confirmaci√≥n -->
      <div class="step" data-step="4">
        <p>Revisa y env√≠a üíå</p>
        <ul class="muted small" id="review"></ul>
      </div>

      <div class="btns">
        <button type="button" class="ghost" id="prev">‚Üê Atr√°s</button>
        <div style="display:flex;gap:8px">
          <button type="button" class="ghost" id="save">Guardar</button>
          <button type="button" class="primary" id="next">Siguiente ‚Üí</button>
          <button type="submit" class="primary" id="submitBtn" style="display:none">Enviar ‚úÖ</button>
        </div>
      </div>
      <p id="status" class="footer"></p>
    </form>
  </div>
</div>

<div class="install-banner" id="installBanner">
  <span class="muted small">¬øQuieres instalar la app?</span>
  <button class="primary" id="installBtn">Instalar</button>
  <button class="ghost" id="dismissBtn">Ahora no</button>
</div>

<script>
(() => {
  const form = document.getElementById('tripForm');
  const steps = [...document.querySelectorAll('.step')];
  const bar = document.getElementById('bar');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const save = document.getElementById('save');
  const submitBtn = document.getElementById('submitBtn');
  const statusEl = document.getElementById('status');
  const reviewEl = document.getElementById('review');
  const STORAGE_KEY = 'form_denis_viaje_v1';
  const EMAIL_ENDPOINT = 'https://formsubmit.co/ajax/rociovelascoig@gmail.com';

  let step = 1;
  const showStep = n => {
    step = Math.max(1, Math.min(steps.length, n));
    steps.forEach(s => s.classList.remove('active'));
    steps[step-1].classList.add('active');
    bar.style.width = ((step-1)/(steps.length-1))*100 + '%';
    prev.style.visibility = step === 1 ? 'hidden' : 'visible';
    next.style.display = step < steps.length ? '' : 'none';
    submitBtn.style.display = step === steps.length ? '' : 'none';
    if(step===steps.length) buildReview();
  };
  const status = (msg, type='') => {statusEl.textContent=msg; statusEl.className='footer '+(type||'');};
  const serialize = () => {const fd=new FormData(form);const data={};for(const [k,v] of fd.entries()){if(data[k]){Array.isArray(data[k])?data[k].push(v):data[k]=[data[k],v];}else data[k]=v;}data._submitted_at=new Date().toISOString();return data;};
  const autosave=()=>{localStorage.setItem(STORAGE_KEY,JSON.stringify(serialize()));status('Borrador guardado','small');};
  const load=()=>{const raw=localStorage.getItem(STORAGE_KEY);if(!raw)return;try{const data=JSON.parse(raw);for(const[k,v]of Object.entries(data)){const el=form.elements[k];if(!el)continue;if(el instanceof RadioNodeList){[...form.querySelectorAll(`[name="${k}"]`)].forEach(inp=>{Array.isArray(v)?inp.checked=v.includes(inp.value):inp.checked=inp.value===v;});}else if(el.type==='checkbox'){el.checked=!!v;}else if(!Array.isArray(v)){el.value=v;}}status('Borrador cargado','small');}catch(e){}};  
  const buildReview=()=>{const data=serialize();reviewEl.innerHTML=Object.entries(data).map(([k,v])=>`<li><strong>${k}:</strong> <span class="muted">${Array.isArray(v)?v.join(', '):v}</span></li>`).join('');};

  next.addEventListener('click',()=>{showStep(step+1);});
  prev.addEventListener('click',()=>showStep(step-1));
  save.addEventListener('click',autosave);

  form.addEventListener('submit',async e=>{
    e.preventDefault();
    status('Enviando‚Ä¶');
    const data=serialize();
    const payload={_subject:`Nueva respuesta: ${data.nombre||'Sin nombre'} ‚Äî Viaje Denis`,_template:"table",_replyto:data.email||"",...data};
    try{
      const res=await fetch(EMAIL_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(payload)});
      if(!res.ok)throw new Error(await res.text());
      status('¬°Enviado! Revisa tu correo üì¨','ok');
      localStorage.removeItem(STORAGE_KEY);
      form.reset();showStep(1);
    }catch(err){console.error(err);status('No se pudo enviar','err');}
  });

  // Splash
  window.addEventListener('load',()=>{document.getElementById('splash').classList.add('fade-out');});
  // SW
  if('serviceWorker'in navigator){navigator.serviceWorker.register('./service-worker.js');}
  // Install banner
  let deferredPrompt=null;
  const banner=document.getElementById('installBanner');
  document.getElementById('installBtn').addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;banner.style.display='none';});
  document.getElementById('dismissBtn').addEventListener('click',()=>banner.style.display='none');
  window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;banner.style.display='flex';});

  load();showStep(1);
})();
</script>
</body>
</html>
