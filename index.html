<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Viaje Denis — by Ro</title>

<!-- PWA meta -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#1e3a8a">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Fuente -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#050507; --bg2:#0f172a;
    --card:rgba(15,23,42,.72); --card-border:rgba(255,255,255,.06);
    --ink:#f3f6fb; --muted:#94a3b8;
    --brand1:#2563eb; --brand2:#1d4ed8; --brand3:#0ea5e9;
    --ok:#22c55e; --warn:#facc15; --err:#ef4444;
    --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box;font-family:Poppins,system-ui,"Segoe UI",Inter,Roboto,Ubuntu,Arial,sans-serif}
  html,body{height:100%}
  body{
    margin:0;color:var(--ink);
    background: radial-gradient(1000px 700px at 80% -10%, #1e3a8a 0%, transparent 55%),
                radial-gradient(800px 600px at -10% 110%, #1e293b 0%, transparent 60%),
                linear-gradient(180deg,var(--bg1),var(--bg2));
  }
  .wrap{max-width:880px;margin:auto;padding:24px; width:100%}
  .card{
    background:var(--card); backdrop-filter: blur(10px);
    border:1px solid var(--card-border); border-radius:var(--radius);
    padding:22px; box-shadow:var(--shadow);
  }
  h1{margin:0 0 6px;font-weight:800;letter-spacing:.2px}
  .subtitle{margin:0 0 16px;color:var(--muted)}
  .muted{color:var(--muted)}
  .progress{height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;margin:10px 0 18px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3));transition:width .35s}
  .step{display:none;gap:14px}
  .step.active{display:block}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid.two{grid-template-columns:1fr 1fr} }
  label{font-weight:600}
  input[type=text], input[type=date], input[type=number], input[type=email], textarea, select{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
    background:rgba(5,8,15,.75); color:var(--ink); outline: none;
    transition: border-color .2s, box-shadow .2s, background .2s;
  }
  input:focus, textarea:focus, select:focus{
    border-color:var(--brand1); box-shadow:0 0 0 3px rgba(37,99,235,.25);
    background:rgba(10,15,25,.9);
  }
  textarea{min-height:96px; resize:vertical}
  .chips{display:flex;flex-wrap:wrap; gap:8px}
  .chip input{display:none}
  .chip span{
    display:inline-block;border:1px solid rgba(255,255,255,.08);
    padding:10px 14px;border-radius:999px;cursor:pointer;
    background:rgba(5,8,15,.65);
    transition: all .2s;
  }
  .chip span:hover{transform: translateY(-1px)}
  .chip input:checked + span{
    border-color: var(--brand1);
    background:rgba(37,99,235,.14);
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.5);
  }
  .range-wrap{display:flex;align-items:center;gap:12px}
  .range-wrap output{min-width:90px;text-align:right;color:var(--muted)}
  .btns{display:flex;gap:10px;justify-content:space-between;margin-top:16px;flex-wrap:wrap}
  button{
    appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;
    transition: transform .06s ease, box-shadow .2s ease, opacity .2s ease;
  }
  button:active{transform: translateY(1px)}
  .primary{
    color:white;
    background:linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3));
    background-size:200% 100%; animation: grad 8s ease infinite;
    box-shadow: 0 6px 20px rgba(37,99,235,.35);
  }
  @keyframes grad { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
  .ghost{background:rgba(255,255,255,.06); color:var(--ink)}
  .ok{color:#0c2; font-weight:700}
  .err{color:var(--err); font-weight:700}
  .small{font-size:.92rem}
  .footer{margin-top:12px;color:var(--muted);font-size:.9rem}
  .install-banner{display:none;margin:14px 24px 0;align-items:center;gap:10px}

  /* Splash */
  .splash{
    position:fixed; inset:0; z-index:9999;
    background:linear-gradient(180deg,#000,#0f172a);
    display:flex; align-items:center; justify-content:center; flex-direction:column;
    color:white; font-size:1.4rem; font-weight:600;
  }
  .splash.fade-out{opacity:0;transition:opacity .6s ease;pointer-events:none}
</style>
</head>
<body>
<!-- Splash -->
<div class="splash" id="splash">
  <div style="font-size:2.4rem;margin-bottom:10px;">🌌</div>
  Cargando Viaje Denis...
</div>

<div class="wrap">
  <div class="card">
    <h1>Formulario de viaje ✈</h1>
    <p class="subtitle">Tu aventura en azul y negro empieza aquí 💙⚫</p>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <form id="tripForm" class="grid" autocomplete="on" novalidate>
      <!-- PASO 1: Datos -->
      <div class="step active" data-step="1">
        <div class="grid two">
          <div>
            <label for="nombre">Tu nombre</label>
            <input id="nombre" name="nombre" type="text" placeholder="Denis" required />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="denis@ejemplo.com" />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="desde">Fechas (desde)</label>
            <input id="desde" name="desde" type="date" />
          </div>
          <div>
            <label for="hasta">Fechas (hasta)</label>
            <input id="hasta" name="hasta" type="date" />
          </div>
        </div>

        <div>
          <label>Tipo de destinos que te apetecen</label>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="destinos_tipo" value="Playa"><span>Playa</span></label>
            <label class="chip"><input type="checkbox" name="destinos_tipo" value="Ciudad"><span>Ciudad</span></label>
            <label class="chip"><input type="checkbox" name="destinos_tipo" value="Naturaleza"><span>Naturaleza</span></label>
            <label class="chip"><input type="checkbox" name="destinos_tipo" value="Cultura/Historia"><span>Cultura/Historia</span></label>
            <label class="chip"><input type="checkbox" name="destinos_tipo" value="Gastronomía"><span>Gastronomía</span></label>
            <label class="chip"><input type="checkbox" name="destinos_tipo" value="Fiesta/Noche"><span>Fiesta/Noche</span></label>
          </div>
        </div>
      </div>

      <!-- PASO 2: Preferencias -->
      <div class="step" data-step="2">
        <div>
          <label>Estilo de viaje</label>
          <div class="chips">
            <label class="chip"><input type="radio" name="estilo" value="Relax"><span>Relax</span></label>
            <label class="chip"><input type="radio" name="estilo" value="Equilibrado"><span>Equilibrado</span></label>
            <label class="chip"><input type="radio" name="estilo" value="Intenso"><span>Intenso</span></label>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="alojamiento">Alojamiento preferido</label>
            <select id="alojamiento" name="alojamiento">
              <option value="">Me vale cualquiera</option>
              <option>Hotel</option>
              <option>Apartamento/Airbnb</option>
              <option>Casa rural</option>
              <option>Hostel</option>
            </select>
          </div>
          <div>
            <label for="transporte">Transporte preferido</label>
            <select id="transporte" name="transporte">
              <option value="">Lo que salga mejor</option>
              <option>Avión</option>
              <option>Tren</option>
              <option>Bus</option>
              <option>Coche</option>
            </select>
          </div>
        </div>

        <div>
          <label>Actividades que te flipan</label>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="actividades" value="Museos"><span>Museos</span></label>
            <label class="chip"><input type="checkbox" name="actividades" value="Senderismo"><span>Senderismo</span></label>
            <label class="chip"><input type="checkbox" name="actividades" value="Playas/Calas"><span>Playas/Calas</span></label>
            <label class="chip"><input type="checkbox" name="actividades" value="Gastronomía local"><span>Gastronomía local</span></label>
            <label class="chip"><input type="checkbox" name="actividades" value="Vida nocturna"><span>Vida nocturna</span></label>
            <label class="chip"><input type="checkbox" name="actividades" value="Compras"><span>Compras</span></label>
            <label class="chip"><input type="checkbox" name="actividades" value="Termas/Spa"><span>Termas/Spa</span></label>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="restricciones">Alimentación / alergias</label>
            <input id="restricciones" name="restricciones" type="text" placeholder="Sin picante, sin marisco, etc." />
          </div>
          <div>
            <label for="ritmo">Ritmo diario ideal</label>
            <select id="ritmo" name="ritmo">
              <option>Mañanas fuertes + tarde chill</option>
              <option>Tardes fuertes + mañana chill</option>
              <option>Non-stop</option>
            </select>
          </div>
        </div>
      </div>

      <!-- PASO 3: Presupuesto y destinos -->
      <div class="step" data-step="3">
        <div>
          <label for="presupuesto">Presupuesto total aprox. (€)</label>
          <div class="range-wrap">
            <input id="presupuesto" name="presupuesto" type="range" min="100" max="3000" step="50" value="600" />
            <output id="presOut">600 €</output>
          </div>
          <small class="muted small">Incluye transporte + alojamiento + actividades.</small>
        </div>

        <div class="grid two">
          <div>
            <label for="destinos">Top destinos (máx. 3)</label>
            <input id="destinos" name="destinos" type="text" placeholder="Ej: Lisboa, Oporto, Menorca" />
          </div>
          <div>
            <label for="evitar">Límites / cosas a evitar</label>
            <input id="evitar" name="evitar" type="text" placeholder="Mucho calor, ferris, etc." />
          </div>
        </div>

        <div>
          <label for="notas">Notas extra</label>
          <textarea id="notas" name="notas" placeholder="Añade cualquier detalle importante"></textarea>
        </div>
      </div>

      <!-- PASO 4: Confirmación -->
      <div class="step" data-step="4">
        <p>Revisa y envía 💌</p>
        <ul class="muted small" id="review"></ul>
        <p class="small muted">Tus respuestas se guardan en este dispositivo hasta que envíes.</p>
      </div>

      <div class="btns">
        <button type="button" class="ghost" id="prev">← Atrás</button>
        <div style="display:flex;gap:8px">
          <button type="button" class="ghost" id="save">Guardar</button>
          <button type="button" class="primary" id="next">Siguiente →</button>
          <button type="submit" class="primary" id="submitBtn" style="display:none">Enviar ✅</button>
        </div>
      </div>

      <p id="status" class="footer"></p>
    </form>
  </div>
</div>

<!-- Banner instalar -->
<div class="install-banner" id="installBanner">
  <span class="muted small">¿Quieres instalar la app?</span>
  <button class="primary" id="installBtn">Instalar</button>
  <button class="ghost" id="dismissBtn">Ahora no</button>
</div>

<script>
(() => {
  const form = document.getElementById('tripForm');
  const steps = [...document.querySelectorAll('.step')];
  const bar = document.getElementById('bar');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const save = document.getElementById('save');
  const submitBtn = document.getElementById('submitBtn');
  const statusEl = document.getElementById('status');
  const reviewEl = document.getElementById('review');
  const range = document.getElementById('presupuesto');
  const out = document.getElementById('presOut');
  const STORAGE_KEY = 'form_denis_viaje_v1';
  const EMAIL_ENDPOINT = 'https://formsubmit.co/ajax/rociovelascoig@gmail.com';

  let step = 1;

  const showStep = n => {
    step = Math.max(1, Math.min(steps.length, n));
    steps.forEach(s => s.classList.remove('active'));
    steps[step-1].classList.add('active');
    bar.style.width = ((step-1)/(steps.length-1))*100 + '%';
    prev.style.visibility = step === 1 ? 'hidden' : 'visible';
    next.style.display = step < steps.length ? '' : 'none';
    submitBtn.style.display = step === steps.length ? '' : 'none';
    status('');
    if (step === steps.length) buildReview();
  };

  const status = (msg, type='') => {
    statusEl.textContent = msg;
    statusEl.className = 'footer ' + (type || '');
  };

  const serialize = () => {
    const fd = new FormData(form);
    const data = {};
    for (const [k,v] of fd.entries()){
      if (data[k]) {
        if (Array.isArray(data[k])) data[k].push(v);
        else data[k] = [data[k], v];
      } else data[k] = v;
    }
    data._submitted_at = new Date().toISOString();
    return data;
  };

  const autosave = () => {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(serialize()));
    status('Borrador guardado', 'small');
  };

  const load = () => {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    try{
      const data = JSON.parse(raw);
      for (const [k,v] of Object.entries(data)){
        const el = form.elements[k];
        if (!el) continue;
        if (el instanceof RadioNodeList){
          [...form.querySelectorAll([name="${k}"])].forEach(inp=>{
            if (Array.isArray(v)) inp.checked = v.includes(inp.value);
            else inp.checked = (inp.value === v);
          });
        } else if (el.type === 'checkbox'){
          el.checked = !!v;
        } else if (!Array.isArray(v)){
          el.value = v;
        }
      }
      if (data.presupuesto) { range.value = data.presupuesto; out.textContent = ${data.presupuesto} €; }
      status('Borrador cargado', 'small');
    }catch(e){}
  };

  const validateStep = () => {
    if (step === 1 && !form.nombre.value.trim()){ status('Pon tu nombre, porfa.', 'err'); return false; }
    if (step === 3 && range.value < 100){ status('Presupuesto mínimo 100 €.', 'err'); return false; }
    status(''); return true;
  };

  const buildReview = () => {
    const data = serialize();
    const entries = [
      ['Nombre', data.nombre || '—'],
      ['Email', data.email || '—'],
      ['Fechas', ${data.desde||'—'} → ${data.hasta||'—'}],
      ['Tipos de destino', (data.destinos_tipo? [].concat(data.destinos_tipo).join(', ') : '—')],
      ['Estilo', data.estilo || '—'],
      ['Alojamiento', data.alojamiento || '—'],
      ['Transporte', data.transporte || '—'],
      ['Actividades', (data.actividades? [].concat(data.actividades).join(', ') : '—')],
      ['Alimentación/alergias', data.restricciones || '—'],
      ['Ritmo', data.ritmo || '—'],
      ['Presupuesto', (data.presupuesto? data.presupuesto + ' €' : '—')],
      ['Top destinos', data.destinos || '—'],
      ['Evitar', data.evitar || '—'],
      ['Notas', data.notas || '—'],
    ];
    reviewEl.innerHTML = entries.map(([k,v]) => <li><strong>${k}:</strong> <span class="muted">${v}</span></li>).join('');
  };

  // Navegación
  next.addEventListener('click', () => { if (!validateStep()) return; showStep(step+1); });
  prev.addEventListener('click', () => showStep(step-1));
  save.addEventListener('click', autosave);

  form.addEventListener('input', e => {
    if (e.target === range) out.textContent = ${range.value} €;
  });
  form.addEventListener('change', e => {
    if (e.target === range) out.textContent = ${range.value} €;
    autosave();
  });

  // Envío a email (FormSubmit)
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = serialize();
    status('Enviando…');
    const payload = {
      _subject: Nueva respuesta: ${data.nombre || 'Sin nombre'} — Viaje Denis,
      _template: "table",
      _replyto: data.email || "",
      ...data
    };
    try{
      const res = await fetch(EMAIL_ENDPOINT, {
        method:'POST',
        headers: {'Content-Type':'application/json','Accept':'application/json'},
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error(await res.text());
      status('¡Enviado! Revisa tu correo 📬', 'ok');
      localStorage.removeItem(STORAGE_KEY);
      form.reset(); showStep(1); window.scrollTo({top:0, behavior:'smooth'});
    }catch(err){
      console.error(err);
      status('No se pudo enviar. Intenta de nuevo más tarde.', 'err');
    }
  });

  // Splash
  window.addEventListener('load', ()=> {
    document.getElementById('splash').classList.add('fade-out');
  });

  // PWA: registrar SW + instalar
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js');
  }
  let deferredPrompt = null;
  const banner = document.getElementById('installBanner');
  const btnInstall = document.getElementById('installBtn');
  const btnDismiss = document.getElementById('dismissBtn');
  window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault(); deferredPrompt = e; banner.style.display = 'flex';
  });
  btnInstall?.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt(); await deferredPrompt.userChoice;
    deferredPrompt = null; banner.style.display = 'none';
  });
  btnDismiss?.addEventListener('click', () => banner.style.display = 'none');

  // init
  load(); showStep(1); out.textContent = ${range.value} €;
})();
</script>
</body>
</html>
